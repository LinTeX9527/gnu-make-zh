# Part I  基本概念 #

[TOC]

## 第一章  如何写一个简单的Makefile  ##
**GNU make**（还有其他的make的变体）做的就是管理源码编译为可执行文件的步骤。**make**定义了一种语言，描述了源码、中间文件、可执行文件之间的关系。**make**使用的指令通常保存在文件*makefile*中。如下是一个编译传统的"Hello, World"的程序的*makefile*文件：
```
hello: hello.c
	gcc hello.c -o hello
```
要想编译这个程序只需要在命令行中键入`make`并且执行。这会让*make*程序读入*makefile*文件并且构建它找到的第一个目标：
```
$ make
gcc hello.c -o hello
```
如果在命令行中指定目标，那么这个目标就会被更新。如果命令行没有给*make*指定目标，那么就会使用*makefile*文件中的第一个目标，这个称为**default goal**。

往往大多数的*makefile*中默认目标是构建程序。通常涉及到很多步骤。很多时候程序的源码是不完整的，必须要使用*flex*或者*bison*等工具生成源码，然后把源码编译成二进制目标文件（了例如C/C++生成`*.o`文件，Java生成`*.class`文件，等等）。接着，对于C/C++而言，链接器把目标文件绑定到一起生成一个可执行文件。



### 目标和必备条件 ###
本质上来说*makefile*包含一系列的规则来构建一个应用程序。*make*找到的第一个规则称为**default rule**。一个规则由3个部分组成：目标，必备条件和命令。
```
target: prereq1 prereq2
	commands
```
目标是文件或者其他必须要做的事情。必备条件或者依赖条件是目标被成功创建之前必须要存在的文件。命令就是那些用来从必备条件创建目标的shell命令。

如下是一个用来把C源文件`foo.c`编译成目标文件`foo.o`的规则：
```
foo.o: foo.c foo.h
	gcc -c foo.c
```
目标文件`foo.o`出现在分号之前。必备条件`foo.c`和`foo.h`在分号之后。命令通常出现在下一行且一个tab缩进。

